import { type ReactNode, useEffect } from "react";
import { useCurrentUserQuery } from "@/redux/features/auth/auth.api";
import { useDispatch, useSelector } from "react-redux";
import {
  selectLoading,
  setCredentials,
  setLoading,
} from "@/redux/features/auth/authSlice";

interface SessionProviderProps {
  children: ReactNode;
}

export default function SessionProvider({ children }: SessionProviderProps) {
  const { data: user, isLoading } = useCurrentUserQuery();
  const dispatch = useDispatch();
  const loading = useSelector(selectLoading);
  useEffect(() => {
    dispatch(setLoading(true));

    if (user) {
      dispatch(setCredentials({ user: user.data }));
    }
    if (!isLoading) {
      dispatch(setLoading(false));
    }
  }, [user, isLoading, dispatch]);

  if (loading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <p>Loading session...</p>
      </div>
    );
  }

  return <>{children}</>;
}
